<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.les.dao.mapper.AnswerMapper">

    <update id="updateAnswerGoal">
        UPDATE answer SET goal=#{goal} where answer_id=#{answerId};
    </update>

    <insert id="insertAnswer">
        INSERT INTO ANSWER(answer_content,examination_id,user_id) VALUES (#{answerContent},#{examinationId},#{userId});
    </insert>

    <update id="updateAnswer">
        UPDATE ANSWER SET answer_content=#{answerContent} WHERE answer_id=#{answerId};
    </update>

    <select id="getUserAnswer" resultType="com.les.po.Answer">
        SELECT * FROM answer a WHERE a.examination_id=#{examId} AND a.user_id=#{userId};
    </select>

    <select id="getAnswerList" resultType="com.les.dto.UserAnswer">
        SELECT
          e.examination_id,
          e.examination_question,
          e.examination_score,
          e.reference_answer,
          e.examination_level,
          a.answer_id,
          a.answer_content,
          a.goal
        FROM examination e
         LEFT JOIN (SELECT
              user_id,
              answer_id,
              examination_id,
              answer_content,
              goal
            FROM answer
            WHERE user_id = #{userId}) a
            ON e.examination_id = a.examination_id
          LEFT JOIN user_info u
            ON u.user_id = a.user_id
        WHERE e.examination_level IN (SELECT
            user_level
          FROM user_info
          WHERE user_id = #{userId});
    </select>

</mapper>